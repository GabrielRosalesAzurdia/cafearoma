{% extends 'base.html' %} {% block title %}AnÃ¡lisis de ProducciÃ³n - CafÃ© Aroma
{% endblock %} {% block content %}
<div class="row">
  <div class="col-12">
    <h1>ðŸ“Š AnÃ¡lisis de ProducciÃ³n</h1>

    <div class="row mb-4">
      <div class="col-md-6">
        <a
          href="{% url 'production:download_report' 'pdf' %}"
          class="btn btn-danger"
        >
          ðŸ“¥ Descargar PDF
        </a>
        <a
          href="{% url 'production:download_report' 'csv' %}"
          class="btn btn-success"
        >
          ðŸ“¥ Descargar CSV
        </a>
        <a href="{% url 'production:report' %}" class="btn btn-info">
          ðŸ“‹ Reporte Simple
        </a>
      </div>
    </div>

    <!-- Tarjetas de EstadÃ­sticas -->
    <div class="row">
      <div class="col-md-3">
        <div class="card text-white bg-primary">
          <div class="card-body">
            <h5 class="card-title">Total Tareas</h5>
            <p class="card-text display-6">{{ total_tasks }}</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-white bg-success">
          <div class="card-body">
            <h5 class="card-title">Completadas</h5>
            <p class="card-text display-6">{{ completed_tasks }}</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-white bg-warning">
          <div class="card-body">
            <h5 class="card-title">En Progreso</h5>
            <p class="card-text display-6">{{ in_progress_tasks }}</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-white bg-info">
          <div class="card-body">
            <h5 class="card-title">CafÃ© Producido</h5>
            <p class="card-text display-6">
              {{ total_coffee_kg|floatformat:1 }} kg
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="row mt-4">
      <!-- DistribuciÃ³n por Etapas -->
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h5>ðŸ“ˆ Tareas por Etapa</h5>
          </div>
          <div class="card-body">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Etapa</th>
                  <th>Cantidad</th>
                  <th>Porcentaje</th>
                </tr>
              </thead>
              <tbody>
                {% for stage_name, count in stages_data.items %}
                <tr>
                  <td>{{ stage_name }}</td>
                  <td>{{ count }}</td>
                  <td>
                    {% if total_tasks > 0 %} {{ count|floatformat:1 }}% {% else
                    %} 0% {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ProducciÃ³n por Tipo de CafÃ© -->
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h5>â˜• ProducciÃ³n por Tipo</h5>
          </div>
          <div class="card-body">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Tipo</th>
                  <th>Lotes</th>
                  <th>Total (kg)</th>
                  <th>PuntuaciÃ³n Prom.</th>
                </tr>
              </thead>
              <tbody>
                {% for type_name, data in coffee_types_data.items %}
                <tr>
                  <td>{{ type_name }}</td>
                  <td>{{ data.count }}</td>
                  <td>{{ data.total_kg|floatformat:1 }} kg</td>
                  <td>
                    {% if data.avg_score > 0 %}
                    <span class="badge bg-success"
                      >{{ data.avg_score|floatformat:1 }}</span
                    >
                    {% else %}
                    <span class="badge bg-secondary">N/A</span>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Lotes Recientes -->
    <div class="row mt-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5>ðŸ“¦ Lotes MÃ¡s Recientes</h5>
          </div>
          <div class="card-body">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>CÃ³digo</th>
                  <th>Tipo</th>
                  <th>Cantidad</th>
                  <th>PuntuaciÃ³n</th>
                  <th>Fecha Prod.</th>
                  <th>Fecha Venc.</th>
                </tr>
              </thead>
              <tbody>
                {% for batch in batches %}
                <tr>
                  <td><strong>{{ batch.code }}</strong></td>
                  <td>{{ batch.get_coffee_type_display }}</td>
                  <td>{{ batch.qty_kg }}kg</td>
                  <td>
                    {% if batch.cupping_score %}
                    <span class="badge bg-success"
                      >{{ batch.cupping_score }}</span
                    >
                    {% else %}
                    <span class="badge bg-secondary">N/A</span>
                    {% endif %}
                  </td>
                  <td>{{ batch.mfg_date }}</td>
                  <td>{{ batch.expiry_date }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
